"use strict";(self.webpackChunkstudio_web=self.webpackChunkstudio_web||[]).push([[154],{9154:(Qe,J,R)=>{R.r(J),R.d(J,{read_along:()=>I});var r,A=R(5861),d=R(4156),O=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},V={};function S(r){return"function"==typeof r}function ee(r){const t=r(a=>{Error.call(a),a.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}r=V,function(){var n=function(){this.init()};n.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window<"u"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var i=this||t;if(e=parseFloat(e),i.ctx||x(),typeof e<"u"&&e>=0&&e<=1){if(i._volume=e,i._muted)return i;i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var o=0;o<i._howls.length;o++)if(!i._howls[o]._webAudio)for(var l=i._howls[o]._getSoundIds(),h=0;h<l.length;h++){var f=i._howls[o]._soundById(l[h]);f&&f._node&&(f._node.volume=f._volume*e)}return i}return i._volume},mute:function(e){var i=this||t;i.ctx||x(),i._muted=e,i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e?0:i._volume,t.ctx.currentTime);for(var o=0;o<i._howls.length;o++)if(!i._howls[o]._webAudio)for(var l=i._howls[o]._getSoundIds(),h=0;h<l.length;h++){var f=i._howls[o]._soundById(l[h]);f&&f._node&&(f._node.muted=!!e||f._muted)}return i},stop:function(){for(var e=this||t,i=0;i<e._howls.length;i++)e._howls[i].stop();return e},unload:function(){for(var e=this||t,i=e._howls.length-1;i>=0;i--)e._howls[i].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close<"u"&&(e.ctx.close(),e.ctx=null,x()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio<"u")try{typeof(new Audio).oncanplaythrough>"u"&&(e._canPlayEvent="canplay")}catch{e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch{}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,i=null;try{i=typeof Audio<"u"?new Audio:null}catch{return e}if(!i||"function"!=typeof i.canPlayType)return e;var o=i.canPlayType("audio/mpeg;").replace(/^no$/,""),l=e._navigator?e._navigator.userAgent:"",h=l.match(/OPR\/(\d+)/g),f=h&&parseInt(h[0].split("/")[1],10)<33,c=-1!==l.indexOf("Safari")&&-1===l.indexOf("Chrome"),b=l.match(/Version\/(.*?) /),v=c&&b&&parseInt(b[1],10)<15;return e._codecs={mp3:!(f||!o&&!i.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!o,opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(i.canPlayType('audio/wav; codecs="1"')||i.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!i.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!i.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(i.canPlayType("audio/x-m4b;")||i.canPlayType("audio/m4b;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(v||!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(v||!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!i.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(i.canPlayType("audio/x-flac;")||i.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&44100!==e.ctx.sampleRate&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var i=function(o){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var l=new Audio;l._unlocked=!0,e._releaseHtml5Audio(l)}catch{e.noAudio=!0;break}for(var h=0;h<e._howls.length;h++)if(!e._howls[h]._webAudio)for(var f=e._howls[h]._getSoundIds(),c=0;c<f.length;c++){var b=e._howls[h]._soundById(f[c]);b&&b._node&&!b._node._unlocked&&(b._node._unlocked=!0,b._node.load())}e._autoResume();var v=e.ctx.createBufferSource();v.buffer=e._scratchBuffer,v.connect(e.ctx.destination),typeof v.start>"u"?v.noteOn(0):v.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),v.onended=function(){v.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",i,!0),document.removeEventListener("touchend",i,!0),document.removeEventListener("click",i,!0),document.removeEventListener("keydown",i,!0);for(var w=0;w<e._howls.length;w++)e._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("click",i,!0),document.addEventListener("keydown",i,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var i=(new Audio).play();return i&&typeof Promise<"u"&&(i instanceof Promise||"function"==typeof i.then)&&i.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var i=this||t;return e._unlocked&&i._html5AudioPool.push(e),i},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&!(typeof e.ctx.suspend>"u")&&t.usingWebAudio){for(var i=0;i<e._howls.length;i++)if(e._howls[i]._webAudio)for(var o=0;o<e._howls[i]._sounds.length;o++)if(!e._howls[i]._sounds[o]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var l=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(l,l)}},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&!(typeof e.ctx.resume>"u")&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then(function(){e.state="running";for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new n,a=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};a.prototype={init:function(e){var i=this;return t.ctx||x(),i._autoplay=e.autoplay||!1,i._format="string"!=typeof e.format?e.format:[e.format],i._html5=e.html5||!1,i._muted=e.mute||!1,i._loop=e.loop||!1,i._pool=e.pool||5,i._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,i._rate=e.rate||1,i._sprite=e.sprite||{},i._src="string"!=typeof e.src?e.src:[e.src],i._volume=void 0!==e.volume?e.volume:1,i._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},i._duration=0,i._state="unloaded",i._sounds=[],i._endTimers={},i._queue=[],i._playLock=!1,i._onend=e.onend?[{fn:e.onend}]:[],i._onfade=e.onfade?[{fn:e.onfade}]:[],i._onload=e.onload?[{fn:e.onload}]:[],i._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],i._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],i._onpause=e.onpause?[{fn:e.onpause}]:[],i._onplay=e.onplay?[{fn:e.onplay}]:[],i._onstop=e.onstop?[{fn:e.onstop}]:[],i._onmute=e.onmute?[{fn:e.onmute}]:[],i._onvolume=e.onvolume?[{fn:e.onvolume}]:[],i._onrate=e.onrate?[{fn:e.onrate}]:[],i._onseek=e.onseek?[{fn:e.onseek}]:[],i._onunlock=e.onunlock?[{fn:e.onunlock}]:[],i._onresume=[],i._webAudio=t.usingWebAudio&&!i._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(i),i._autoplay&&i._queue.push({event:"play",action:function(){i.play()}}),i._preload&&"none"!==i._preload&&i.load(),i},load:function(){var e=this,i=null;if(t.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var o=0;o<e._src.length;o++){var l,h;if(e._format&&e._format[o])l=e._format[o];else{if("string"!=typeof(h=e._src[o])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(l=/^data:audio\/([^;,]+);/i.exec(h))||(l=/\.([^.]+)$/.exec(h.split("?",1)[0])),l&&(l=l[1].toLowerCase())}if(l||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),l&&t.codecs(l)){i=e._src[o];break}}if(i)return e._src=i,e._state="loading","https:"===window.location.protocol&&"http:"===i.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new s(e),e._webAudio&&_(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,i){var o=this,l=null;if("number"==typeof e)l=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if(typeof e>"u"&&(e="__default",!o._playLock)){for(var h=0,f=0;f<o._sounds.length;f++)o._sounds[f]._paused&&!o._sounds[f]._ended&&(h++,l=o._sounds[f]._id);1===h?e=null:l=null}}var c=l?o._soundById(l):o._inactiveSound();if(!c)return null;if(l&&!e&&(e=c._sprite||"__default"),"loaded"!==o._state){c._sprite=e,c._ended=!1;var b=c._id;return o._queue.push({event:"play",action:function(){o.play(b)}}),b}if(l&&!c._paused)return i||o._loadQueue("play"),c._id;o._webAudio&&t._autoResume();var v=Math.max(0,c._seek>0?c._seek:o._sprite[e][0]/1e3),w=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-v),T=1e3*w/Math.abs(c._rate),E=o._sprite[e][0]/1e3,q=(o._sprite[e][0]+o._sprite[e][1])/1e3;c._sprite=e,c._ended=!1;var K=function(){c._paused=!1,c._seek=v,c._start=E,c._stop=q,c._loop=!(!c._loop&&!o._sprite[e][2])};if(!(v>=q)){var y=c._node;if(o._webAudio){var pe=function(){o._playLock=!1,K(),o._refreshBuffer(c),y.gain.setValueAtTime(c._muted||o._muted?0:c._volume,t.ctx.currentTime),c._playStart=t.ctx.currentTime,typeof y.bufferSource.start>"u"?y.bufferSource.noteGrainOn(0,v,c._loop?86400:w):y.bufferSource.start(0,v,c._loop?86400:w),T!==1/0&&(o._endTimers[c._id]=setTimeout(o._ended.bind(o,c),T)),i||setTimeout(function(){o._emit("play",c._id),o._loadQueue()},0)};"running"===t.state&&"interrupted"!==t.ctx.state?pe():(o._playLock=!0,o.once("resume",pe),o._clearTimer(c._id))}else{var ge=function(){y.currentTime=v,y.muted=c._muted||o._muted||t._muted||y.muted,y.volume=c._volume*t.volume(),y.playbackRate=c._rate;try{var P=y.play();if(P&&typeof Promise<"u"&&(P instanceof Promise||"function"==typeof P.then)?(o._playLock=!0,K(),P.then(function(){o._playLock=!1,y._unlocked=!0,i?o._loadQueue():o._emit("play",c._id)}).catch(function(){o._playLock=!1,o._emit("playerror",c._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),c._ended=!0,c._paused=!0})):i||(o._playLock=!1,K(),o._emit("play",c._id)),y.playbackRate=c._rate,y.paused)return void o._emit("playerror",c._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||c._loop?o._endTimers[c._id]=setTimeout(o._ended.bind(o,c),T):(o._endTimers[c._id]=function(){o._ended(c),y.removeEventListener("ended",o._endTimers[c._id],!1)},y.addEventListener("ended",o._endTimers[c._id],!1))}catch(Ze){o._emit("playerror",c._id,Ze)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===y.src&&(y.src=o._src,y.load());var Xe=window&&window.ejecta||!y.readyState&&t._navigator.isCocoonJS;if(y.readyState>=3||Xe)ge();else{o._playLock=!0,o._state="loading";var me=function(){o._state="loaded",ge(),y.removeEventListener(t._canPlayEvent,me,!1)};y.addEventListener(t._canPlayEvent,me,!1),o._clearTimer(c._id)}}return c._id}o._ended(c)},pause:function(e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"pause",action:function(){i.pause(e)}}),i;for(var o=i._getSoundIds(e),l=0;l<o.length;l++){i._clearTimer(o[l]);var h=i._soundById(o[l]);if(h&&!h._paused&&(h._seek=i.seek(o[l]),h._rateSeek=0,h._paused=!0,i._stopFade(o[l]),h._node))if(i._webAudio){if(!h._node.bufferSource)continue;typeof h._node.bufferSource.stop>"u"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),i._cleanBuffer(h._node)}else(!isNaN(h._node.duration)||h._node.duration===1/0)&&h._node.pause();arguments[1]||i._emit("pause",h?h._id:null)}return i},stop:function(e,i){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var l=o._getSoundIds(e),h=0;h<l.length;h++){o._clearTimer(l[h]);var f=o._soundById(l[h]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,o._stopFade(l[h]),f._node&&(o._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),o._cleanBuffer(f._node)):(!isNaN(f._node.duration)||f._node.duration===1/0)&&(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&o._clearSound(f._node))),i||o._emit("stop",f._id))}return o},mute:function(e,i){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"mute",action:function(){o.mute(e,i)}}),o;if(typeof i>"u"){if("boolean"!=typeof e)return o._muted;o._muted=e}for(var l=o._getSoundIds(i),h=0;h<l.length;h++){var f=o._soundById(l[h]);f&&(f._muted=e,f._interval&&o._stopFade(f._id),o._webAudio&&f._node?f._node.gain.setValueAtTime(e?0:f._volume,t.ctx.currentTime):f._node&&(f._node.muted=!!t._muted||e),o._emit("mute",f._id))}return o},volume:function(){var o,l,c,e=this,i=arguments;if(0===i.length)return e._volume;if(1===i.length||2===i.length&&typeof i[1]>"u"?e._getSoundIds().indexOf(i[0])>=0?l=parseInt(i[0],10):o=parseFloat(i[0]):i.length>=2&&(o=parseFloat(i[0]),l=parseInt(i[1],10)),!(typeof o<"u"&&o>=0&&o<=1))return(c=l?e._soundById(l):e._sounds[0])?c._volume:0;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,i)}}),e;typeof l>"u"&&(e._volume=o),l=e._getSoundIds(l);for(var b=0;b<l.length;b++)(c=e._soundById(l[b]))&&(c._volume=o,i[2]||e._stopFade(l[b]),e._webAudio&&c._node&&!c._muted?c._node.gain.setValueAtTime(o,t.ctx.currentTime):c._node&&!c._muted&&(c._node.volume=o*t.volume()),e._emit("volume",c._id));return e},fade:function(e,i,o,l){var h=this;if("loaded"!==h._state||h._playLock)return h._queue.push({event:"fade",action:function(){h.fade(e,i,o,l)}}),h;e=Math.min(Math.max(0,parseFloat(e)),1),i=Math.min(Math.max(0,parseFloat(i)),1),o=parseFloat(o),h.volume(e,l);for(var f=h._getSoundIds(l),c=0;c<f.length;c++){var b=h._soundById(f[c]);if(b){if(l||h._stopFade(f[c]),h._webAudio&&!b._muted){var v=t.ctx.currentTime,w=v+o/1e3;b._volume=e,b._node.gain.setValueAtTime(e,v),b._node.gain.linearRampToValueAtTime(i,w)}h._startFadeInterval(b,e,i,o,f[c],typeof l>"u")}}return h},_startFadeInterval:function(e,i,o,l,h,f){var c=this,b=i,v=o-i,w=Math.abs(v/.01),T=Math.max(4,w>0?l/w:l),E=Date.now();e._fadeTo=o,e._interval=setInterval(function(){var q=(Date.now()-E)/l;E=Date.now(),b+=v*q,b=Math.round(100*b)/100,b=v<0?Math.max(o,b):Math.min(o,b),c._webAudio?e._volume=b:c.volume(b,e._id,!0),f&&(c._volume=b),(o<i&&b<=o||o>i&&b>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,c.volume(o,e._id),c._emit("fade",e._id))},T)},_stopFade:function(e){var i=this,o=i._soundById(e);return o&&o._interval&&(i._webAudio&&o._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(o._interval),o._interval=null,i.volume(o._fadeTo,e),o._fadeTo=null,i._emit("fade",e)),i},loop:function(){var o,l,h,e=this,i=arguments;if(0===i.length)return e._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(h=e._soundById(parseInt(i[0],10)))&&h._loop;e._loop=o=i[0]}else 2===i.length&&(o=i[0],l=parseInt(i[1],10));for(var f=e._getSoundIds(l),c=0;c<f.length;c++)(h=e._soundById(f[c]))&&(h._loop=o,e._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=o,o&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,e.playing(f[c])&&(e.pause(f[c],!0),e.play(f[c],!0)))));return e},rate:function(){var o,l,c,e=this,i=arguments;if(0===i.length?l=e._sounds[0]._id:1===i.length?e._getSoundIds().indexOf(i[0])>=0?l=parseInt(i[0],10):o=parseFloat(i[0]):2===i.length&&(o=parseFloat(i[0]),l=parseInt(i[1],10)),"number"!=typeof o)return(c=e._soundById(l))?c._rate:e._rate;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,i)}}),e;typeof l>"u"&&(e._rate=o),l=e._getSoundIds(l);for(var b=0;b<l.length;b++)if(c=e._soundById(l[b])){e.playing(l[b])&&(c._rateSeek=e.seek(l[b]),c._playStart=e._webAudio?t.ctx.currentTime:c._playStart),c._rate=o,e._webAudio&&c._node&&c._node.bufferSource?c._node.bufferSource.playbackRate.setValueAtTime(o,t.ctx.currentTime):c._node&&(c._node.playbackRate=o);var v=e.seek(l[b]),T=1e3*((e._sprite[c._sprite][0]+e._sprite[c._sprite][1])/1e3-v)/Math.abs(c._rate);(e._endTimers[l[b]]||!c._paused)&&(e._clearTimer(l[b]),e._endTimers[l[b]]=setTimeout(e._ended.bind(e,c),T)),e._emit("rate",c._id)}return e},seek:function(){var o,l,e=this,i=arguments;if(0===i.length?e._sounds.length&&(l=e._sounds[0]._id):1===i.length?e._getSoundIds().indexOf(i[0])>=0?l=parseInt(i[0],10):e._sounds.length&&(l=e._sounds[0]._id,o=parseFloat(i[0])):2===i.length&&(o=parseFloat(i[0]),l=parseInt(i[1],10)),typeof l>"u")return 0;if("number"==typeof o&&("loaded"!==e._state||e._playLock))return e._queue.push({event:"seek",action:function(){e.seek.apply(e,i)}}),e;var c=e._soundById(l);if(c){if(!("number"==typeof o&&o>=0)){if(e._webAudio){var T=e.playing(l)?t.ctx.currentTime-c._playStart:0;return c._seek+((c._rateSeek?c._rateSeek-c._seek:0)+T*Math.abs(c._rate))}return c._node.currentTime}var b=e.playing(l);b&&e.pause(l,!0),c._seek=o,c._ended=!1,e._clearTimer(l),!e._webAudio&&c._node&&!isNaN(c._node.duration)&&(c._node.currentTime=o);var v=function(){b&&e.play(l,!0),e._emit("seek",l)};if(b&&!e._webAudio){var w=function(){e._playLock?setTimeout(w,0):v()};setTimeout(w,0)}else v()}return e},playing:function(e){var i=this;if("number"==typeof e){var o=i._soundById(e);return!!o&&!o._paused}for(var l=0;l<i._sounds.length;l++)if(!i._sounds[l]._paused)return!0;return!1},duration:function(e){var i=this,o=i._duration,l=i._soundById(e);return l&&(o=i._sprite[l._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,i=e._sounds,o=0;o<i.length;o++)i[o]._paused||e.stop(i[o]._id),e._webAudio||(e._clearSound(i[o]._node),i[o]._node.removeEventListener("error",i[o]._errorFn,!1),i[o]._node.removeEventListener(t._canPlayEvent,i[o]._loadFn,!1),i[o]._node.removeEventListener("ended",i[o]._endFn,!1),t._releaseHtml5Audio(i[o]._node)),delete i[o]._node,e._clearTimer(i[o]._id);var l=t._howls.indexOf(e);l>=0&&t._howls.splice(l,1);var h=!0;for(o=0;o<t._howls.length;o++)if(t._howls[o]._src===e._src||e._src.indexOf(t._howls[o]._src)>=0){h=!1;break}return u&&h&&delete u[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,i,o,l){return"function"==typeof i&&this["_on"+e].push(l?{id:o,fn:i,once:l}:{id:o,fn:i}),this},off:function(e,i,o){var l=this,h=l["_on"+e],f=0;if("number"==typeof i&&(o=i,i=null),i||o)for(f=0;f<h.length;f++){var c=o===h[f].id;if(i===h[f].fn&&c||!i&&c){h.splice(f,1);break}}else if(e)l["_on"+e]=[];else{var b=Object.keys(l);for(f=0;f<b.length;f++)0===b[f].indexOf("_on")&&Array.isArray(l[b[f]])&&(l[b[f]]=[])}return l},once:function(e,i,o){return this.on(e,i,o,1),this},_emit:function(e,i,o){for(var l=this,h=l["_on"+e],f=h.length-1;f>=0;f--)(!h[f].id||h[f].id===i||"load"===e)&&(setTimeout(function(c){c.call(this,i,o)}.bind(l,h[f].fn),0),h[f].once&&l.off(e,h[f].fn,h[f].id));return l._loadQueue(e),l},_loadQueue:function(e){var i=this;if(i._queue.length>0){var o=i._queue[0];o.event===e&&(i._queue.shift(),i._loadQueue()),e||o.action()}return i},_ended:function(e){var i=this,o=e._sprite;if(!i._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(i._ended.bind(i,e),100),i;var l=!(!e._loop&&!i._sprite[o][2]);if(i._emit("end",e._id),!i._webAudio&&l&&i.stop(e._id,!0).play(e._id),i._webAudio&&l){i._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var h=1e3*(e._stop-e._start)/Math.abs(e._rate);i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),h)}return i._webAudio&&!l&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,i._clearTimer(e._id),i._cleanBuffer(e._node),t._autoSuspend()),!i._webAudio&&!l&&i.stop(e._id,!0),i},_clearTimer:function(e){var i=this;if(i._endTimers[e]){if("function"!=typeof i._endTimers[e])clearTimeout(i._endTimers[e]);else{var o=i._soundById(e);o&&o._node&&o._node.removeEventListener("ended",i._endTimers[e],!1)}delete i._endTimers[e]}return i},_soundById:function(e){for(var i=this,o=0;o<i._sounds.length;o++)if(e===i._sounds[o]._id)return i._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var i=0;i<e._sounds.length;i++)if(e._sounds[i]._ended)return e._sounds[i].reset();return new s(e)},_drain:function(){var e=this,i=e._pool,o=0,l=0;if(!(e._sounds.length<i)){for(l=0;l<e._sounds.length;l++)e._sounds[l]._ended&&o++;for(l=e._sounds.length-1;l>=0;l--){if(o<=i)return;e._sounds[l]._ended&&(e._webAudio&&e._sounds[l]._node&&e._sounds[l]._node.disconnect(0),e._sounds.splice(l,1),o--)}}},_getSoundIds:function(e){if(typeof e>"u"){for(var o=[],l=0;l<this._sounds.length;l++)o.push(this._sounds[l]._id);return o}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=u[this._src],e._node.bufferSource.connect(e._panner?e._panner:e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var o=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),o))try{e.bufferSource.buffer=t._scratchBuffer}catch{}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(e){this._parent=e,this.init()};s.prototype={init:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,i._sounds.push(e),e.create(),e},create:function(){var e=this,i=e._parent,o=t._muted||e._muted||e._parent._muted?0:e._volume;return i._webAudio?(e._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(o,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=i._src,e._node.preload=!0===i._preload?"auto":i._preload,e._node.volume=o*t.volume(),e._node.load()),e},reset:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,i=e._parent;i._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(i._sprite).length&&(i._sprite={__default:[0,1e3*i._duration]}),"loaded"!==i._state&&(i._state="loaded",i._emit("load"),i._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,i=e._parent;i._duration===1/0&&(i._duration=Math.ceil(10*e._node.duration)/10,i._sprite.__default[1]===1/0&&(i._sprite.__default[1]=1e3*i._duration),i._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var u={},_=function(e){var i=e._src;if(u[i])return e._duration=u[i].duration,void g(e);if(/^data:[^;]+;base64,/.test(i)){for(var o=atob(i.split(",")[1]),l=new Uint8Array(o.length),h=0;h<o.length;++h)l[h]=o.charCodeAt(h);p(l.buffer,e)}else{var f=new XMLHttpRequest;f.open(e._xhr.method,i,!0),f.withCredentials=e._xhr.withCredentials,f.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(c){f.setRequestHeader(c,e._xhr.headers[c])}),f.onload=function(){var c=(f.status+"")[0];"0"===c||"2"===c||"3"===c?p(f.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+f.status+".")},f.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete u[i],e.load())},m(f)}},m=function(e){try{e.send()}catch{e.onerror()}},p=function(e,i){var o=function(){i._emit("loaderror",null,"Decoding audio data failed.")},l=function(h){h&&i._sounds.length>0?(u[i._src]=h,g(i,h)):o()};typeof Promise<"u"&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(l).catch(o):t.ctx.decodeAudioData(e,l,o)},g=function(e,i){i&&!e._duration&&(e._duration=i.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},x=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),i=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=i?parseInt(i[1],10):null;if(e&&o&&o<9){var l=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!l&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};r.Howler=t,r.Howl=a,typeof O<"u"?(O.HowlerGlobal=n,O.Howler=t,O.Howl=a,O.Sound=s):typeof window<"u"&&(window.HowlerGlobal=n,window.Howler=t,window.Howl=a,window.Sound=s)}(),function(){var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var a=this;if(!a.ctx||!a.ctx.listener)return a;for(var s=a._howls.length-1;s>=0;s--)a._howls[s].stereo(t);return a},HowlerGlobal.prototype.pos=function(t,a,s){var u=this;return u.ctx&&u.ctx.listener?"number"!=typeof t?u._pos:(u._pos=[t,a="number"!=typeof a?u._pos[1]:a,s="number"!=typeof s?u._pos[2]:s],typeof u.ctx.listener.positionX<"u"?(u.ctx.listener.positionX.setTargetAtTime(u._pos[0],Howler.ctx.currentTime,.1),u.ctx.listener.positionY.setTargetAtTime(u._pos[1],Howler.ctx.currentTime,.1),u.ctx.listener.positionZ.setTargetAtTime(u._pos[2],Howler.ctx.currentTime,.1)):u.ctx.listener.setPosition(u._pos[0],u._pos[1],u._pos[2]),u):u},HowlerGlobal.prototype.orientation=function(t,a,s,u,_,m){var p=this;if(!p.ctx||!p.ctx.listener)return p;var g=p._orientation;return"number"!=typeof t?g:(p._orientation=[t,a="number"!=typeof a?g[1]:a,s="number"!=typeof s?g[2]:s,u="number"!=typeof u?g[3]:u,_="number"!=typeof _?g[4]:_,m="number"!=typeof m?g[5]:m],typeof p.ctx.listener.forwardX<"u"?(p.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),p.ctx.listener.forwardY.setTargetAtTime(a,Howler.ctx.currentTime,.1),p.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),p.ctx.listener.upX.setTargetAtTime(u,Howler.ctx.currentTime,.1),p.ctx.listener.upY.setTargetAtTime(_,Howler.ctx.currentTime,.1),p.ctx.listener.upZ.setTargetAtTime(m,Howler.ctx.currentTime,.1)):p.ctx.listener.setOrientation(t,a,s,u,_,m),p)},Howl.prototype.init=(t=Howl.prototype.init,function(a){var s=this;return s._orientation=a.orientation||[1,0,0],s._stereo=a.stereo||null,s._pos=a.pos||null,s._pannerAttr={coneInnerAngle:typeof a.coneInnerAngle<"u"?a.coneInnerAngle:360,coneOuterAngle:typeof a.coneOuterAngle<"u"?a.coneOuterAngle:360,coneOuterGain:typeof a.coneOuterGain<"u"?a.coneOuterGain:0,distanceModel:typeof a.distanceModel<"u"?a.distanceModel:"inverse",maxDistance:typeof a.maxDistance<"u"?a.maxDistance:1e4,panningModel:typeof a.panningModel<"u"?a.panningModel:"HRTF",refDistance:typeof a.refDistance<"u"?a.refDistance:1,rolloffFactor:typeof a.rolloffFactor<"u"?a.rolloffFactor:1},s._onstereo=a.onstereo?[{fn:a.onstereo}]:[],s._onpos=a.onpos?[{fn:a.onpos}]:[],s._onorientation=a.onorientation?[{fn:a.onorientation}]:[],t.call(this,a)}),Howl.prototype.stereo=function(t,a){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"stereo",action:function(){s.stereo(t,a)}}),s;var u=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof a>"u"){if("number"!=typeof t)return s._stereo;s._stereo=t,s._pos=[t,0,0]}for(var _=s._getSoundIds(a),m=0;m<_.length;m++){var p=s._soundById(_[m]);if(p){if("number"!=typeof t)return p._stereo;p._stereo=t,p._pos=[t,0,0],p._node&&(p._pannerAttr.panningModel="equalpower",(!p._panner||!p._panner.pan)&&n(p,u),"spatial"===u?typeof p._panner.positionX<"u"?(p._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):p._panner.setPosition(t,0,0):p._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),s._emit("stereo",p._id)}}return s},Howl.prototype.pos=function(t,a,s,u){var _=this;if(!_._webAudio)return _;if("loaded"!==_._state)return _._queue.push({event:"pos",action:function(){_.pos(t,a,s,u)}}),_;if(a="number"!=typeof a?0:a,s="number"!=typeof s?-.5:s,typeof u>"u"){if("number"!=typeof t)return _._pos;_._pos=[t,a,s]}for(var m=_._getSoundIds(u),p=0;p<m.length;p++){var g=_._soundById(m[p]);if(g){if("number"!=typeof t)return g._pos;g._pos=[t,a,s],g._node&&((!g._panner||g._panner.pan)&&n(g,"spatial"),typeof g._panner.positionX<"u"?(g._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),g._panner.positionY.setValueAtTime(a,Howler.ctx.currentTime),g._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):g._panner.setPosition(t,a,s)),_._emit("pos",g._id)}}return _},Howl.prototype.orientation=function(t,a,s,u){var _=this;if(!_._webAudio)return _;if("loaded"!==_._state)return _._queue.push({event:"orientation",action:function(){_.orientation(t,a,s,u)}}),_;if(a="number"!=typeof a?_._orientation[1]:a,s="number"!=typeof s?_._orientation[2]:s,typeof u>"u"){if("number"!=typeof t)return _._orientation;_._orientation=[t,a,s]}for(var m=_._getSoundIds(u),p=0;p<m.length;p++){var g=_._soundById(m[p]);if(g){if("number"!=typeof t)return g._orientation;g._orientation=[t,a,s],g._node&&(g._panner||(g._pos||(g._pos=_._pos||[0,0,-.5]),n(g,"spatial")),typeof g._panner.orientationX<"u"?(g._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),g._panner.orientationY.setValueAtTime(a,Howler.ctx.currentTime),g._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):g._panner.setOrientation(t,a,s)),_._emit("orientation",g._id)}}return _},Howl.prototype.pannerAttr=function(){var s,u,_,t=this,a=arguments;if(!t._webAudio)return t;if(0===a.length)return t._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(_=t._soundById(parseInt(a[0],10)))?_._pannerAttr:t._pannerAttr;s=a[0],typeof u>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),t._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:t._panningModel})}else 2===a.length&&(s=a[0],u=parseInt(a[1],10));for(var m=t._getSoundIds(u),p=0;p<m.length;p++)if(_=t._soundById(m[p])){var g=_._pannerAttr;g={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:g.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:g.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:g.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:g.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:g.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:g.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:g.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:g.panningModel};var x=_._panner;x||(_._pos||(_._pos=t._pos||[0,0,-.5]),n(_,"spatial"),x=_._panner),x.coneInnerAngle=g.coneInnerAngle,x.coneOuterAngle=g.coneOuterAngle,x.coneOuterGain=g.coneOuterGain,x.distanceModel=g.distanceModel,x.maxDistance=g.maxDistance,x.refDistance=g.refDistance,x.rolloffFactor=g.rolloffFactor,x.panningModel=g.panningModel}return t},Sound.prototype.init=function(t){return function(){var a=this,s=a._parent;a._orientation=s._orientation,a._stereo=s._stereo,a._pos=s._pos,a._pannerAttr=s._pannerAttr,t.call(this),a._stereo?s.stereo(a._stereo):a._pos&&s.pos(a._pos[0],a._pos[1],a._pos[2],a._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var a=this,s=a._parent;return a._orientation=s._orientation,a._stereo=s._stereo,a._pos=s._pos,a._pannerAttr=s._pannerAttr,a._stereo?s.stereo(a._stereo):a._pos?s.pos(a._pos[0],a._pos[1],a._pos[2],a._id):a._panner&&(a._panner.disconnect(0),a._panner=void 0,s._refreshBuffer(a)),t.call(this)}}(Sound.prototype.reset);var n=function(t,a){"spatial"===(a=a||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}();const G=ee(r=>function(t){r(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((a,s)=>`${s+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function N(r,n){if(r){const t=r.indexOf(n);0<=t&&r.splice(t,1)}}class k{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:a}=this;if(S(a))try{a()}catch(u){n=u instanceof G?u.errors:[u]}const{_finalizers:s}=this;if(s){this._finalizers=null;for(const u of s)try{re(u)}catch(_){n=n??[],_ instanceof G?n=[...n,..._.errors]:n.push(_)}}if(n)throw new G(n)}}add(n){var t;if(n&&n!==this)if(this.closed)re(n);else{if(n instanceof k){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&N(t,n)}remove(n){const{_finalizers:t}=this;t&&N(t,n),n instanceof k&&n._removeParent(this)}}k.EMPTY=(()=>{const r=new k;return r.closed=!0,r})();const te=k.EMPTY;function ne(r){return r instanceof k||r&&"closed"in r&&S(r.remove)&&S(r.add)&&S(r.unsubscribe)}function re(r){S(r)?r():r.unsubscribe()}const L={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},F={setTimeout(r,n,...t){const{delegate:a}=F;return a?.setTimeout?a.setTimeout(r,n,...t):setTimeout(r,n,...t)},clearTimeout(r){const{delegate:n}=F;return(n?.clearTimeout||clearTimeout)(r)},delegate:void 0};function ie(){}const ve=W("C",void 0,void 0);function W(r,n,t){return{kind:r,value:n,error:t}}let D=null;function M(r){if(L.useDeprecatedSynchronousErrorHandling){const n=!D;if(n&&(D={errorThrown:!1,error:null}),r(),n){const{errorThrown:t,error:a}=D;if(D=null,t)throw a}}else r()}class $ extends k{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,ne(n)&&n.add(this)):this.destination=ke}static create(n,t,a){return new j(n,t,a)}next(n){this.isStopped?z(function we(r){return W("N",r,void 0)}(n),this):this._next(n)}error(n){this.isStopped?z(function ye(r){return W("E",void 0,r)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?z(ve,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const xe=Function.prototype.bind;function U(r,n){return xe.call(r,n)}class Ae{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(a){B(a)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(a){B(a)}else B(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){B(t)}}}class j extends ${constructor(n,t,a){let s;if(super(),S(n)||!n)s={next:n??void 0,error:t??void 0,complete:a??void 0};else{let u;this&&L.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),s={next:n.next&&U(n.next,u),error:n.error&&U(n.error,u),complete:n.complete&&U(n.complete,u)}):s=n}this.destination=new Ae(s)}}function B(r){!function be(r){F.setTimeout(()=>{const{onUnhandledError:n}=L;if(!n)throw r;n(r)})}(r)}function z(r,n){const{onStoppedNotification:t}=L;t&&F.setTimeout(()=>t(r,n))}const ke={closed:!0,next:ie,error:function Se(r){throw r},complete:ie},Te="function"==typeof Symbol&&Symbol.observable||"@@observable";function ae(r){return r}let oe=(()=>{class r{constructor(t){t&&(this._subscribe=t)}lift(t){const a=new r;return a.source=this,a.operator=t,a}subscribe(t,a,s){const u=function Pe(r){return r&&r instanceof $||function Ee(r){return r&&S(r.next)&&S(r.error)&&S(r.complete)}(r)&&ne(r)}(t)?t:new j(t,a,s);return M(()=>{const{operator:_,source:m}=this;u.add(_?_.call(u,m):m?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(a){t.error(a)}}forEach(t,a){return new(a=se(a))((s,u)=>{const _=new j({next:m=>{try{t(m)}catch(p){u(p),_.unsubscribe()}},error:u,complete:s});this.subscribe(_)})}_subscribe(t){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(t)}[Te](){return this}pipe(...t){return function Ie(r){return 0===r.length?ae:1===r.length?r[0]:function(t){return r.reduce((a,s)=>s(a),t)}}(t)(this)}toPromise(t){return new(t=se(t))((a,s)=>{let u;this.subscribe(_=>u=_,_=>s(_),()=>a(u))})}}return r.create=n=>new r(n),r})();function se(r){var n;return null!==(n=r??L.Promise)&&void 0!==n?n:Promise}class Re extends ${constructor(n,t,a,s,u,_){super(n),this.onFinalize=u,this.shouldUnsubscribe=_,this._next=t?function(m){try{t(m)}catch(p){n.error(p)}}:super._next,this._error=s?function(m){try{s(m)}catch(p){n.error(p)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(m){n.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}const Fe=ee(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let H=(()=>{class r extends oe{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const a=new le(this,this);return a.operator=t,a}_throwIfClosed(){if(this.closed)throw new Fe}next(t){M(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const a of this.currentObservers)a.next(t)}})}error(t){M(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:a}=this;for(;a.length;)a.shift().error(t)}})}complete(){M(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:a,isStopped:s,observers:u}=this;return a||s?te:(this.currentObservers=null,u.push(t),new k(()=>{this.currentObservers=null,N(u,t)}))}_checkFinalizedStatuses(t){const{hasError:a,thrownError:s,isStopped:u}=this;a?t.error(s):u&&t.complete()}asObservable(){const t=new oe;return t.source=this,t}}return r.create=(n,t)=>new le(n,t),r})();class le extends H{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,a;null===(a=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===a||a.call(t,n)}error(n){var t,a;null===(a=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===a||a.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,a;return null!==(a=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==a?a:te}}class De extends H{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:a}=this;if(n)throw t;return this._throwIfClosed(),a}next(n){super.next(this._value=n)}}function Me(r,n=ae){return r=r??Be,function Le(r){return n=>{if(function Oe(r){return S(r?.lift)}(n))return n.lift(function(t){try{return r(t,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}((t,a)=>{let s,u=!0;t.subscribe(function Ce(r,n,t,a,s){return new Re(r,n,t,a,s)}(a,_=>{const m=n(_);(u||!r(s,m))&&(u=!1,s=m,a.next(_))}))})}function Be(r,n){return r===n}const ue="RAUserPreferences",Y="0.1";function X(){return X=(0,A.Z)(function*(r){let n=yield fetch(r);if(!n.ok)return console.error(`fetch(${r}) failed with status ${n.status}`),{pages:null,meta:null};let t=yield n.text(),s=(new DOMParser).parseFromString(t,"text/xml");return{pages:ce(s),meta:de(s)}}),X.apply(this,arguments)}function ce(r){return Array.from(r.querySelectorAll("div[type=page]")).map(t=>{let a=t.querySelector("graphic[url]"),s=t.querySelectorAll("p"),u={id:t.getAttribute("id"),paragraphs:Array.from(s)};return null!==a&&(u.img=a.getAttribute("url")),t.attributes&&(u.attributes=t.attributes),u})}function de(r){let n={};return Array.from(r.querySelectorAll("meta")).forEach(t=>{const a=t.getAttribute("name");let s=t.getAttribute("content");n[a]=s.trim()}),n}var he=function(r){var n=this;n.sounds=[],n._sprite=r.sprite,n._reading$=new H,n._tinySprite=Object.keys(r.sprite).map(t=>[n._sprite[t][0],t,n._sprite[t][0]+n._sprite[t][1]]),n._tinySprite.pop(),n._percentPlayed=new De("0%"),n.sound=new V.Howl({src:r.src,sprite:r.sprite,rate:r.rate,onend:function(){n._reading$.next("")}}),requestAnimationFrame(n.step.bind(n))};function Ve(r){return Z.apply(this,arguments)}function Z(){return Z=(0,A.Z)(function*(r){return new Promise(function(n,t){let a=new XMLHttpRequest;a.open("HEAD",r),a.onload=function(){n(this.status>=200&&this.status<300)},a.onerror=function(){n(!1)},a.send()})}),Z.apply(this,arguments)}he.prototype={play:function(r){var n=this;return n._spriteLeft=n._tinySprite,n.sound.play(r)},pause:function(){return this.sound.pause(),this.sound.id},goBack:function(r,n){var t=this;if(t._spriteLeft=t._tinySprite,t.sound.seek(r)-n>0){r=t.sound.seek(t.sound.seek(r)-n,r);for(var a=t.sound.seek(r),s=0;s<t._spriteLeft.length;s++)1e3*a>=t._spriteLeft[s][0]&&(1e3*a<=t._spriteLeft[s][2]&&t._reading$.next(t._spriteLeft[s][1]),t._spriteLeft=t._spriteLeft.slice(s,t._spriteLeft.length));t._reading$.next(t._spriteLeft[0][1])}else r=t.sound.seek(0,r),t._reading$.next(t._spriteLeft[0][1]);return r},goTo:function(a,n){var t=this;t._spriteLeft=t._tinySprite,a=t.sound.seek(n,a);for(var s=1e3*t.sound.seek(a),u=0;u<t._spriteLeft.length;u++)if(s>=t._spriteLeft[u][0]&&s<=t._spriteLeft[u][2]){t._reading$.next(t._spriteLeft[u][1]),a=t.sound.seek(t._spriteLeft[u][0],a),t.sound.seek(a),t._spriteLeft=t._spriteLeft.slice(u,t._spriteLeft.length);break}if(t.sounds.length){const _=(Math.round(n/t.sound.duration(a)*100)||0)+"%";t.sounds[0].style.width=_,t.sounds[0].setAttribute("offset",_)}return a},stop:function(){return this._reading$.next(""),this.sound.stop()},step:function(){for(var r=this,n=0;n<r.sounds.length;n++){for(var t=r.sound.seek()||0,a=0;a<r._spriteLeft.length;a++)t>0&&1e3*t>=r._spriteLeft[a][0]&&(1e3*t<=r._spriteLeft[a][2]&&r._reading$.next(r._spriteLeft[a][1]),r._spriteLeft=r._spriteLeft.slice(a,r._spriteLeft.length));let s=(t/r.sound.duration()*100||0)+"%";r.sounds[n].style.width=s,r.sounds[n].setAttribute("offset",s)}requestAnimationFrame(r.step.bind(r))}};const We=r=>r.innerHTML.includes("</w>"),$e={page:"Page",speed:"Playback Speed","re-align":"Re-align with audio","loading-error":'Error: the <FILETYPE> file "<FILENAME>" could not be loaded.',"parse-error":'Error: the <FILETYPE> file "<FILENAME>" could not be parsed.',"alignment-error":"Error: No alignments were found.",loading:"Loading...","line-placeholder":"Type your text here","upload-image":"Upload an image for this page","choose-file":"Choose a file","play-tooltip":"Play/pause audio recording","rewind-tooltip":"Rewind 5 seconds","stop-tooltip":"Stop audio playback","theme-tooltip":"Toggle dark/light mode","full-screen-tooltip":"Full screen mode","translation-tooltip":"Toggle translations","add-translation":"Add a translation, transliteration or gloss","configuration-tooltip":"Preferences",settings:"My preferences","page-animation":"Animated page transitions","auto-pause":"Pause at the end of each page",language:"Interface language","save-settings":"Remember my preferences for this site",eng:"English",fra:"French",spa:"Spanish",close:"Close","annotations-tooltip":"Annotations"},Ue={page:"Page",speed:"Vitesse de Lecture","re-align":"R\xe9aligner avec l'audio","loading-error":'Erreur: le fichier <FILETYPE> "<FILENAME>" n\'a pas pu \xeatre charg\xe9.',"parse-error":'Erreur: le fichier <FILETYPE> "<FILENAME>" n\'a pas pu \xeatre analys\xe9.',"alignment-error":"Erreur: aucun alignement n'a \xe9t\xe9 trouv\xe9.",loading:"Chargement en cours","line-placeholder":"\xc9crivez votre texte ici","upload-image":"Ajouter une image \xe0 cette page","choose-file":"Choisir un fichier","play-tooltip":"\xc9couter/mettre en pause l'enregistrement","rewind-tooltip":"Reculer de 5 secondes","stop-tooltip":"Arr\xeater la lecture","theme-tooltip":"Basculer en mode sombre/clair","full-screen-tooltip":"Mode plein \xe9cran","translation-tooltip":"Afficher ou cacher les traductions","add-translation":"Ajouter une traduction, une translit\xe9ration ou une glose","configuration-tooltip":"Pr\xe9f\xe9rences",settings:"Mes pr\xe9f\xe9rences","page-animation":"Transitions de page anim\xe9es","auto-pause":"Pause \xe0 la fin de chaque page",language:"Langue de l'interface","save-settings":"Sauvegarder mes pr\xe9f\xe9rences pour ce site",eng:"Anglais",fra:"Fran\xe7ais",spa:"Espagnol",close:"Fermer","annotations-tooltip":"Annotations"},je={page:"P\xe1gina",speed:"Velocidad de reproducci\xf3n","re-align":"Re-alinear con el audio","loading-error":'Error: el fichero <FILETYPE> "<FILENAME>" no se pudo cargar.',"parse-error":'Error: el fichero <FILETYPE> "<FILENAME>" no se pudo analizar.',"alignment-error":"Error: No se encontr\xf3 ning\xfan alineamiento.",loading:"Cargando...","line-placeholder":"Escriba su texto aqu\xed","upload-image":"Cargue una imagen para esta p\xe1gina","choose-file":"Seleccione un fichero","play-tooltip":"Reproducir/pausar grabaci\xf3n de audio","rewind-tooltip":"Rebobine (rewind) 5 segundos","stop-tooltip":"Pare la reproducci\xf3n de audio","theme-tooltip":"Cambie la paleta de colores","full-screen-tooltip":"Modo pantalla completa","translation-tooltip":"Active o desactive las traducciones","add-translation":"A\xf1ada una traducci\xf3n, transliteraci\xf3n o glosa","configuration-tooltip":"Preferencias",settings:"Mis preferencias","page-animation":"Transici\xf3nes de p\xe1gina animadas","auto-pause":"Pausa al final de cada p\xe1gina",language:"Idioma de la interfaz","save-settings":"Recordar mis preferencias para este sitio",eng:"Ingl\xe9s",fra:"Franc\xe9s",spa:"Espa\xf1ol",close:"Cerrar","annotations-tooltip":"Anotaciones"},I=class{constructor(r){(0,d.r)(this,r),this.reading$=new H,this.i18nStrings={eng:$e,fra:Ue,spa:je},this.playback_rate=1,this.showGuide=!1,this.hasTextTranslations=!1,this.assetsStatus={AUDIO:0,RAS:0},this.alignment_failed=!1,this.isScrolling=!1,this.scrollTimer=null,this.endOfPageTags={},this.meta={},this.Guide=()=>(0,d.h)("button",{class:"scroll-guide__container ripple ui-button theme--"+this.theme,onClick:()=>this.hideGuideAndScroll()},(0,d.h)("span",{class:"scroll-guide__text theme--"+this.theme},this.getI18nString("re-align"))),this.Overlay=()=>(0,d.h)("object",{onClick:n=>this.goToSeekFromProgress(n),id:"overlay__object",type:"image/svg+xml",data:this.svgOverlay}),this.RemoveImg=n=>(0,d.h)("button",{"data-test-id":"delete-button","aria-label":"Delete",title:"Delete image",onClick:()=>this.deleteImage(n.pageIndex),id:"img-remover",class:"ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons"},"delete")),this.Img=n=>(0,d.h)("div",{class:"image__container page__col__image theme--"+this.theme},(0,d.h)("img",{alt:"image",class:"image",src:n.imgURL})),this.ImgPlaceHolder=n=>(0,d.h)("div",{class:"image__container page__col__image theme--"+this.theme},(0,d.h)("div",{class:"drop-area"},(0,d.h)("form",{class:"my-form"},(0,d.h)("p",{class:"theme--"+this.theme},this.getI18nString("upload-image")),(0,d.h)("input",{type:"file",class:"fileElem",id:"fileElem--"+n.pageID,accept:"image/*",onChange:t=>this.handleFiles(t.target.files[0],n.pageIndex)}),(0,d.h)("label",{class:"button",htmlFor:"fileElem--"+n.pageID},this.getI18nString("choose-file"))))),this.PageCount=n=>(0,d.h)("div",{class:"page__counter color--"+this.theme},this.getI18nString("page")," ",(0,d.h)("span",{"data-test-id":"page-count__current"},n.currentPage)," / ",(0,d.h)("span",{"data-test-id":"page-count__total"},n.pgCount)),this.ImgContainer=n=>(0,d.h)("div",{class:"image__container"},(0,d.h)("span",{id:"image-container"},"EDIT"===this.mode&&n.pageIndex in this.images&&null!==this.images[n.pageIndex]?(0,d.h)(this.RemoveImg,{pageIndex:n.pageIndex}):null,n.pageIndex in this.images&&null!==this.images[n.pageIndex]?(0,d.h)(this.Img,{imgURL:this.images[n.pageIndex]}):null),"EDIT"!==this.mode||n.pageIndex in this.images&&null!==this.images[n.pageIndex]?null:(0,d.h)(this.ImgPlaceHolder,{pageID:n.pageID,pageIndex:n.pageIndex})),this.Page=n=>(0,d.h)("div",{class:"page page__container page--multi animate-transition  theme--"+this.theme+" "+(n.pageData.attributes.class?n.pageData.attributes.class.value:""),id:n.pageData.id},this.parsed_text.length>1?(0,d.h)(this.PageCount,{pgCount:this.parsed_text.length,currentPage:this.parsed_text.indexOf(n.pageData)+1}):null,(0,d.h)(this.ImgContainer,{pageID:n.pageData.id,pageIndex:this.parsed_text.indexOf(n.pageData)}),(0,d.h)("div",{class:"page__col__text paragraph__container theme--"+this.theme},n.pageData.paragraphs.map(t=>(0,d.h)(this.Paragraph,{sentences:Array.from(t.childNodes),attributes:t.attributes})))),this.Paragraph=n=>(0,d.h)("div",Object.assign({},n.attributes,{class:"paragraph sentence__container theme--"+this.theme+" "+(n.attributes.class?n.attributes.class.value:"")}),n.sentences.map(t=>t.childNodes.length>0&&(0,d.h)(this.Sentence,{sentenceData:t}))),this.Sentence=n=>{let t=Array.from(n.sentenceData.childNodes),a=n.sentenceData.id;!this.hasTextTranslations&&n.sentenceData.hasAttribute("class")&&(this.hasTextTranslations=/translation/.test(n.sentenceData.getAttribute("class")));let s={};for(const u of["annotation-id","do-not-align","lang","id"])n.sentenceData.hasAttribute(u)&&(s[u]=n.sentenceData.getAttribute(u));return n.sentenceData.hasAttribute("xml:lang")&&(s.lang=n.sentenceData.getAttribute("xml:lang")),"EDIT"===this.mode&&/translation/.test(n.sentenceData.getAttribute("class"))?(0,d.h)(d.F,null):(0,d.h)("div",Object.assign({},s,{class:"sentence "+(n.sentenceData.hasAttribute("class")?n.sentenceData.getAttribute("class"):"")+(s["annotation-id"]?" invisible":"")}),t.map((u,_)=>{if("#text"===u.nodeName)return(0,d.h)(this.NonWordText,{text:u.textContent,attributes:u.attributes,id:(n.sentenceData.hasAttribute("id")?n.sentenceData.getAttribute("id"):"P")+"text"+_});if("w"===u.nodeName||"W"===u.nodeName)return(0,d.h)(this.Word,{text:u.textContent,id:u.id,attributes:u.attributes});if(u){let m={};return u.hasAttribute("xml:lang")&&(m.lang=n.sentenceData.getAttribute("xml:lang")),u.hasAttribute("lang")&&(m.lang=n.sentenceData.getAttribute("lang")),(0,d.h)("span",Object.assign({},m,{class:"sentence__text theme--"+this.theme+" "+u.className,id:u.id?u.id:"text_"+_}),u.textContent)}}),(()=>"EDIT"!==this.mode||/translation/.test(n.sentenceData.getAttribute("class"))?null:a in this.translations&&a in this.translations&&null!==this.translations[a]?(0,d.h)("span",{class:"sentence__translation"},(0,d.h)("button",{title:"Remove translation","aria-label":"Remove translation","data-test-id":"remove-translation-button",onClick:()=>this.removeLine(n.sentenceData),class:"sentence__translation__button remove"},(0,d.h)("i",{class:"material-icons"},"remove")),(0,d.h)("p",{id:a+"translation","data-test-id":"translation-line",class:"sentence__text editable__translation",onInput:u=>{this.updateTranslation(a,u.currentTarget.innerText)},contentEditable:!0,onKeyDown:u=>{"Enter"==u.key&&u.preventDefault()},"data-placeholder":this.getI18nString("line-placeholder"),innerHTML:this.translations[a]})):(0,d.h)("button",{title:this.getI18nString("add-translation"),"aria-label":"Add translation","data-test-id":"add-translation-button",class:"sentence__translation sentence__translation__button",onClick:()=>this.addLine(n.sentenceData)},(0,d.h)("i",{class:"material-icons"},"add")))())},this.NonWordText=n=>{let t={};return n.attributes&&n.attributes["xml:lang"]&&(t.lang=n.attributes["xml:lang"].value),n.attributes&&n.attributes.lang&&(t.lang=n.attributes.lang.value),(0,d.h)("span",Object.assign({},t,{class:"sentence__text theme--"+this.theme,id:n.id}),n.text)},this.Word=n=>{let t={};return n.attributes&&n.attributes["xml:lang"]&&(t.lang=n.attributes["xml:lang"].value),n.attributes&&n.attributes.lang&&(t.lang=n.attributes.lang.value),(0,d.h)("span",Object.assign({},t,{class:"sentence__word theme--"+this.theme+" "+(n&&n.attributes.class?n.attributes.class.value:""),id:n.id,onClick:a=>this.playSprite(a)}),n.text)},this.PlayControl=()=>(0,d.h)("button",{"data-test-id":"play-button",disabled:!this.isReadyToPlay(),"aria-label":"Play",title:this.getI18nString("play-tooltip"),onClick:()=>{this.playing?this.pause():this.play()},class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme,tabindex:1},(0,d.h)("i",{class:"material-icons"},this.playing?"pause":"play_arrow")),this.ReplayControl=()=>(0,d.h)("button",{"data-test-id":"replay-button",disabled:this.hasLoaded<2,"aria-label":"Rewind",title:this.getI18nString("rewind-tooltip"),onClick:()=>this.goBack(5),class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons"},"replay_5")),this.StopControl=()=>(0,d.h)("button",{"data-test-id":"stop-button",disabled:this.hasLoaded<2,"aria-label":"Stop",title:this.getI18nString("stop-tooltip"),onClick:()=>this.stop(),class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons"},"stop")),this.PlaybackSpeedControl=()=>(0,d.h)("div",null,(0,d.h)("h5",{class:"control-panel__buttons__header color--"+this.theme,id:"speed-slider-label"},this.getI18nString("speed")),(0,d.h)("input",{type:"range",min:100-this.playbackRateRange,max:100+this.playbackRateRange,value:100*this.playback_rate,class:"slider control-panel__control",id:"myRange","aria-labelledby":"speed-slider-label",onInput:n=>{console.log("v",n),this.changePlayback(n)}})),this.StyleControl=()=>(0,d.h)("button",{"aria-label":"Change theme",title:this.getI18nString("theme-tooltip"),class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons-outlined"},"style")),this.FullScreenControl=()=>(0,d.h)("button",{"aria-label":"Full screen mode",onClick:()=>this.toggleFullscreen(),title:this.getI18nString("full-screen-tooltip"),class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons","aria-label":"Full screen mode"},this.fullscreen?"fullscreen_exit":"fullscreen")),this.TextAnnotationsControl=()=>(0,d.h)("button",{"data-test-id":"annotations-toggle","aria-label":"Toggle Annotations",title:this.getI18nString("annotations-tooltip"),onClick:()=>this.annotationsMenuVisible=!this.annotationsMenuVisible,class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons-outlined"},"layers")),this.TextTranslationDisplayControl=()=>(0,d.h)("button",{"data-test-id":"translation-toggle","aria-label":"Toggle Translation",title:this.getI18nString("translation-tooltip"),onClick:()=>this.toggleTextTranslation(),class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons-outlined"},"subtitles")),this.ToggleSettingsControl=()=>(0,d.h)("button",{"data-test-id":"settings-button",title:this.getI18nString("configuration-tooltip"),onClick:()=>this.toggleSettings(),id:"settings-button",class:"control-panel__control ripple theme--"+this.theme+" background--"+this.theme},(0,d.h)("i",{class:"material-icons","aria-label":"Show settings"},"settings")),this.ErrorMessage=n=>(0,d.h)("p",{"data-test-id":n.data_cy,class:"alert status-error"},(0,d.h)("span",{class:"material-icons"},"error_outline")," ",n.msg),this.ControlPanel=()=>(0,d.h)("div",{"data-test-id":"control-panel",class:"control-panel theme--"+this.theme+" background--"+this.theme},(0,d.h)("div",{class:"control-panel__buttons--left"},(0,d.h)(this.PlayControl,null),(0,d.h)(this.ReplayControl,null),(0,d.h)(this.StopControl,null)),(0,d.h)("div",{class:"control-panel__buttons--center"},(0,d.h)(this.PlaybackSpeedControl,null)),(0,d.h)("div",{class:"control-panel__buttons--right"},this.annotations.length>0?(0,d.h)(this.TextAnnotationsControl,null):this.hasTextTranslations&&(0,d.h)(this.TextTranslationDisplayControl,null),window.document.fullscreenEnabled&&(0,d.h)(this.FullScreenControl,null),(0,d.h)(this.ToggleSettingsControl,null))),this.Settings=()=>(0,d.h)("div",{id:"settings","data-test-id":"settings",class:"settings  theme--"+this.theme},(0,d.h)("button",{class:"close","data-test-id":"settings-close-button",onClick:()=>{this.toggleSettings()}},"\xd7"," "),(0,d.h)("h3",null,this.getI18nString("settings")),(0,d.h)("p",null,(0,d.h)("label",null,(0,d.h)("select",{title:this.getI18nString("language"),onChange:n=>{this.language=n.target.value,this.userPreferencesDirty=!0},"data-test-id":"settings-language",tabindex:2},(0,d.h)("option",{selected:"eng"==this.language,value:"eng"},this.getI18nString("eng")),(0,d.h)("option",{selected:"fra"==this.language,value:"fra"},this.getI18nString("fra")),(0,d.h)("option",{selected:"spa"==this.language,value:"spa"},this.getI18nString("spa"))),this.getI18nString("language"))),(0,d.h)("p",{onClick:()=>{this.changeTheme(),this.userPreferencesDirty=!0},tabindex:3},(0,d.h)(this.StyleControl,null),this.getI18nString("theme-tooltip")),(0,d.h)("p",{onClick:()=>{this.toggleScrollBehavior(),this.userPreferencesDirty=!0},tabindex:4},(0,d.h)("button",{class:"control-panel__control  ripple theme--"+this.theme+" background--"+this.theme,title:this.getI18nString("page-animation"),"data-test-id":"settings-scroll-behavior"},(0,d.h)("i",{class:"material-icons-outlined"},"smooth"===this.scrollBehaviour?"check_box":"check_box_outline_blank")),this.getI18nString("page-animation")),(0,d.h)("p",{onClick:()=>{this.autoPauseAtEndOfPage=!this.autoPauseAtEndOfPage,this.userPreferencesDirty=!0},tabindex:5},(0,d.h)("button",{class:"control-panel__control  ripple theme--"+this.theme+" background--"+this.theme,title:this.getI18nString("auto-pause"),"data-test-id":"settings-auto-pause"},(0,d.h)("i",{class:"material-icons-outlined"},this.autoPauseAtEndOfPage?"check_box":"check_box_outline_blank")),this.getI18nString("auto-pause")),(0,d.h)("p",{class:"version"},"@readalongs/web-component version: ","1.5.2"),(0,d.h)("div",{class:"footer"},(0,d.h)("button",{type:"button",class:"control-panel__control  ripple theme--"+this.theme+" background--"+this.theme,title:this.getI18nString("save-settings"),onClick:()=>{(r=>{window.localStorage.setItem(ue,JSON.stringify(r))})({version:Y,autoPauseAtEndOfPage:this.autoPauseAtEndOfPage,scrollBehaviour:this.scrollBehaviour,language:this.language,theme:this.theme}),this.userPreferencesDirty=!1},"data-test-id":"settings-save",disabled:!this.userPreferencesDirty,tabindex:6},this.getI18nString("save-settings")),(0,d.h)("div",null),(0,d.h)("button",{onClick:()=>this.toggleSettings(),class:"control-panel__control  ripple theme--"+this.theme+" background--"+this.theme,tabindex:7},this.getI18nString("close")))),this.AnnotationsMenu=()=>(0,d.h)("div",{id:"annotationsMenu",class:"annotations-menu  theme--"+this.theme},this.annotations.map(n=>(0,d.h)("button",{"data-test-id":"toggle-annotation-"+n.id,class:"ripple theme--"+this.theme+" background--"+this.theme,onClick:()=>this.toggleTextAnnotation(n.id)},(0,d.h)("i",{class:"material-icons-outlined"}," ",n.isVisible?"check_box":"check_box_outline_blank")," ",n.name)),(0,d.h)("button",{"data-test-id":"toggle-all-annotations",class:"ripple theme--"+this.theme+" background--"+this.theme,onClick:()=>this.toggleTextAnnotation("*")},(0,d.h)("i",{class:"material-icons-outlined"},"layers")," All")),this.href=void 0,this.audio=void 0,this.svgOverlay=void 0,this.theme="light",this.language="eng",this.cssUrl=void 0,this.useAssetsFolder=void 0,this.imageAssetsFolder="assets/",this.pageScrolling="horizontal",this.mode="VIEW",this.scrollBehaviour="smooth",this.displayTranslation=!0,this.playbackRateRange=15,this.autoPauseAtEndOfPage=!1,this.playing=!1,this.fullscreen=!1,this.autoScroll=!0,this.hasLoaded=0,this.images=void 0,this.translations=void 0,this.settingsVisible=!1,this.userPreferencesDirty=!1,this.annotations=[],this.annotationsMenuVisible=!1}handleScrollEvent(){this.isScrolling=!0,this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{this.isScrolling=!1},125)}wheelHandler(r){if(this.el.shadowRoot.querySelector(".reading")&&r.path&&r.path.length>0&&(r.path[0].classList.contains("sentence__word")||r.path[0].classList.contains("sentence__container")||r.path[0].classList.contains("sentence"))&&this.autoScroll){let n=this.el.shadowRoot.querySelector(".reading");n&&(this.autoScroll=!this.inPageContentOverflow(n),this.showGuide=!this.autoScroll)}}fullScreenHandler(){this.fullscreen=null!=window.document.fullscreenElement}handleKeyDown(r){"Escape"===r.key&&this.settingsVisible&&(this.settingsVisible=!1)}urlTransform(r){return void 0!==this.useAssetsFolder?this.useAssetsFolder&&n(r)&&!r.startsWith("blob")?"assets/"+r:r:this.imageAssetsFolder&&n(r)&&!r.startsWith("blob")?(this.imageAssetsFolder&&!this.imageAssetsFolder.endsWith("/")&&(this.imageAssetsFolder+="/"),this.imageAssetsFolder+r):r;function n(t){return!/^(https?:[/][/]|assets[/]|data:)/.test(t)}}buildSprite(r,n){return new he({src:[r],sprite:n,rate:this.playback_rate})}tagToQuery(r){return"#"+(r=r.replace(".","\\.")).replace("#","\\#")}returnWordClosestTo(r){let n=Object.keys(this.processed_alignment);n.pop();for(let t=1;t<n.length;t++)if(1e3*r>this.processed_alignment[n[t]][0]&&this.processed_alignment[n[t+1]]&&1e3*r<this.processed_alignment[n[t+1]][0])return this.el.shadowRoot.querySelector(this.tagToQuery(n[t]))}getPathFromAssetType(r){return"AUDIO"===r?this.audio:"RAS"===r?this.href:"Asset Path Not Supported"}toggleSettings(){this.playing&&this.pause(),this.settingsVisible=!this.settingsVisible}toggleScrollBehavior(){this.scrollBehaviour="auto"===this.scrollBehaviour?"smooth":"auto"}changePlayback(r){this.playback_rate=parseInt(r.currentTarget.value)/100,this.audio_howl_sprites.sound.rate(this.playback_rate)}goBack(r){this.autoScroll=!1,this.play_id&&this.audio_howl_sprites.goBack(this.play_id,r),setTimeout(()=>this.autoScroll=!0,100)}goTo(r){void 0===this.play_id&&(this.play(),this.pause()),this.autoScroll=!0,this.audio_howl_sprites.goTo(this.play_id,r/=1e3),setTimeout(()=>this.autoScroll=!0,100)}goToSeekAtEl(r){let t=r.currentTarget.id;return this.goTo(this.processed_alignment[t][0]),t}goToSeekFromProgress(r){let t=r.currentTarget.getBoundingClientRect();this.goTo((r.pageX-t.left)/t.width*this.duration*1e3)}pause(){this.playing&&(this.playing=!1,this.audio_howl_sprites.pause())}play(){void 0!==this.audio_howl_sprites&&(this.playing=!0,this.play_id=this.audio_howl_sprites.play(void 0!==this.play_id?this.play_id:"all"),this.animateProgress())}playSprite(r){let n=this.goToSeekAtEl(r);this.playing||this.audio_howl_sprites.play(n)}stop(){this.playing=!1,this.play_id=void 0,this.audio_howl_sprites&&this.audio_howl_sprites.stop(),this.el.shadowRoot.querySelectorAll(".reading").forEach(r=>r.classList.remove("reading")),this.autoScroll||(this.autoScroll=!0,this.showGuide=!1)}toggleTextTranslation(){this.el.shadowRoot.querySelectorAll(".translation, .sentence__translation, [annotation-id]").forEach(r=>r.classList.toggle("invisible"))}toggleTextAnnotation(r){this.el.shadowRoot.querySelectorAll("[annotation-id"+("*"===r?"]":'="'+r+'"]')).forEach(n=>n.classList.toggle("invisible")),this.annotations=this.annotations.map(n=>((n.id==r||"*"===r)&&(n.isVisible=!n.isVisible),n))}addHighlightingTo(r){this.el.shadowRoot.querySelectorAll(".reading").forEach(n=>n.classList.remove("reading")),r.classList.add("reading")}animateProgressWithOverlay(){let r=this.el.shadowRoot.querySelector("#overlay__object"),n=r.contentDocument.querySelector("#progress-fill"),t=r.contentDocument.querySelector("#progress-trail"),a=r.contentDocument.querySelector("#progress-base");n.classList.add("stop-color--"+this.theme),a.classList.add("stop-color--"+this.theme),this.audio_howl_sprites.sounds.push(n),this.audio_howl_sprites.sounds.push(t),this.audio_howl_sprites.sound.once("end",()=>{this.audio_howl_sprites.sounds.forEach(s=>{s.setAttribute("offset","0%")}),this.el.shadowRoot.querySelectorAll(".reading").forEach(s=>s.classList.remove("reading")),this.playing=!1},this.play_id)}animateProgressDefault(r,n){let t=document.createElement("div");t.className="progress theme--"+this.theme,t.id=r.toString(),t.dataset.sprite=n;let a=this.tagToQuery(n);this.el.shadowRoot.querySelector(a).appendChild(t),this.audio_howl_sprites.sounds.push(t),this.audio_howl_sprites.sound.once("end",()=>{this.el.shadowRoot.querySelectorAll(".reading").forEach(s=>s.classList.remove("reading")),this.playing=!1},this.play_id)}animateProgress(r=this.play_id){this.svgOverlay?this.animateProgressWithOverlay():r&&this.animateProgressDefault(r,"all")}changeFill(){let r=this.el.shadowRoot.querySelector(".sentence__word"),n=window.getComputedStyle(r).color,t=this.el.shadowRoot.querySelector("#overlay__object"),a=t.contentDocument.querySelector("#progress-fill"),s=t.contentDocument.querySelector("#progress-base");t.contentDocument.querySelector("#polygon").setAttribute("stroke",n),s.setAttribute("stop-color",n),a.setAttribute("stop-color",n)}getCurrentWord(){var r=this;return(0,A.Z)(function*(){return r.reading$})()}getImages(){var r=this;return(0,A.Z)(function*(){return r.images})()}updateSpriteAlignments(r){var n=this;return(0,A.Z)(function*(){n.stop(),n.processed_alignment=r,n.attachScrollingLogicToAudio()})()}getReadAlongElement(){var r=this;return(0,A.Z)(function*(){return r.el})()}getAlignments(){var r=this;return(0,A.Z)(function*(){return r.processed_alignment})()}getTranslations(){var r=this;return(0,A.Z)(function*(){return r.translations})()}changeTheme(){var r=this;return(0,A.Z)(function*(){r.theme="light"===r.theme?"dark":"light"})()}static _getSentenceContainerOfWord(r){return r.parentElement.parentElement.parentElement}toggleFullscreen(){let r;if(this.fullscreen){let n=this.el.ownerDocument;n.exitFullscreen?r=n.exitFullscreen():n.mozCancelFullScreen?r=n.mozCancelFullScreen():n.webkitExitFullscreen?r=n.webkitExitFullscreen():n.msExitFullscreen&&(r=n.msExitFullscreen()),r.then(()=>{this.fullscreen=!1,this.el.shadowRoot.getElementById("read-along-container").classList.remove("read-along-container--fullscreen")})}else{let n=this.el.shadowRoot.getElementById("read-along-container");n.requestFullscreen?r=n.requestFullscreen():n.mozRequestFullScreen?r=n.mozRequestFullScreen():n.webkitRequestFullscreen?r=n.webkitRequestFullscreen():n.msRequestFullscreen&&(r=n.msRequestFullscreen()),r.then(()=>{this.fullscreen=!0,this.el.shadowRoot.getElementById("read-along-container").classList.add("read-along-container--fullscreen")})}}hideGuideAndScroll(){let r=this.el.shadowRoot.querySelector(".reading"),n=new IntersectionObserver(t=>{let[a]=t;a.isIntersecting&&(setTimeout(()=>{this.showGuide=!1,this.autoScroll=!0},100),n.unobserve(r))});n.observe(r),this.scrollTo(r)}inParagraphContentOverflow(r){let t=I._getSentenceContainerOfWord(r).getBoundingClientRect(),a=r.getBoundingClientRect(),s=a.right<t.left,u=a.right>t.right,_=new IntersectionObserver(m=>{let[p]=m;p.isIntersecting&&(setTimeout(()=>{this.showGuide=!1,this.autoScroll=!0},100),_.unobserve(r))});return _.observe(r),s||u}inPageContentOverflow(r){let t=this.el.shadowRoot.querySelector("#"+this.current_page).getBoundingClientRect(),a=r.getBoundingClientRect(),s=a.top+a.height>t.top+t.height,u=a.top<t.top,_=new IntersectionObserver(m=>{let[p]=m;p.isIntersecting&&(setTimeout(()=>{this.showGuide=!1,this.autoScroll=!0},100),u=s=!1,_.unobserve(r))});return _.observe(r),u||s}inPage(r){let t=I._getSentenceContainerOfWord(r).getBoundingClientRect(),a=r.getBoundingClientRect(),s=a.top+a.height>t.top+t.height,u=a.top+a.height<0,_=new IntersectionObserver(m=>{let[p]=m;p.isIntersecting&&(setTimeout(()=>{this.showGuide=!1,this.autoScroll=!0},100),_.unobserve(r))});return _.observe(r),u||s}scrollToPage(r){let n=this.el.shadowRoot.querySelector(".pages__container"),t=this.el.shadowRoot.querySelector("#"+r);n.scrollBy({top:null!=this.pageScrolling.match("vertical")?t.offsetTop-n.scrollTop:0,left:null!=this.pageScrolling.match("vertical")?0:t.offsetLeft-n.scrollLeft,behavior:this.scrollBehaviour}),t.scrollTo(0,0)}scrollByHeight(r){let n=I._getSentenceContainerOfWord(r),t=r.parentElement.getBoundingClientRect(),a=new IntersectionObserver(s=>{let[u]=s;u.isIntersecting?a.unobserve(r):n.scrollTo({top:n.getBoundingClientRect().height-t.height,left:0,behavior:this.scrollBehaviour})},{root:n,threshold:[0,.25,.5,.75,1]});a.observe(r)}scrollByWidth(r){let n=I._getSentenceContainerOfWord(r),t=r.getBoundingClientRect();n.scrollTo({left:t.left-10,top:0,behavior:this.scrollBehaviour})}scrollTo(r){r.scrollIntoView({behavior:this.scrollBehaviour})}disconnectedCallback(){this.stop()}componentDidUpdate(){this.svgOverlay&&this.changeFill()}componentWillLoad(){var r=this;return(0,A.Z)(function*(){window.matchMedia&&(r.theme=window.matchMedia("prefers-color-scheme: dark").matches?"dark":"light");const n=(()=>{const r=window.localStorage.getItem(ue);if(r&&r.length){const n=JSON.parse(r);if(n.version&&n.version===Y)return n}return null})();null!==n&&n.version===Y&&(r.language=n.language,r.scrollBehaviour=n.scrollBehaviour,r.autoPauseAtEndOfPage=n.autoPauseAtEndOfPage,r.theme=n.theme||r.theme),r.language.length<3&&(r.language=null!=r.language.match("fr")?"fra":null!==r.language.match("es")?"spa":"eng"),"smooth"!==r.scrollBehaviour&&"auto"!==r.scrollBehaviour&&(console.error("Invalid scroll-behaviour value, using default (smooth)"),r.scrollBehaviour="smooth"),(isNaN(r.playbackRateRange)||r.playbackRateRange<0||r.playbackRateRange>99)&&(console.error("Invalid playback-rate-range value, using default (15)."),r.playbackRateRange=15);const t=r.el.querySelector("read-along > text");if(t)r.parsed_text=ce(t),r.meta=de(r.el);else{const s=yield function He(r){return X.apply(this,arguments)}(r.href);r.parsed_text=s.pages,r.meta=s.meta}if(null===r.parsed_text)r.parsed_text=[],r.assetsStatus.RAS=3;else if(0===r.parsed_text.length)r.assetsStatus.RAS=2;else{r.images={},r.translations={};for(const[s,u]of r.parsed_text.entries()){if("img"in u){var a=r.urlTransform(u.img);r.images[s]=r.urlTransform(u.img),/^(https?:[/]|assets)[/]\b/.test(a)&&((yield Ve(a))||(r.images[s]=null))}else r.images[s]=null;if("paragraphs"in u){try{const m=u.paragraphs,p=m[m.length-1].querySelectorAll("s:not(.translation), s:not(.sentence__translation)"),g=p[p.length-1].querySelector("w:last-of-type");r.endOfPageTags[g.id]=[parseFloat(g.getAttribute("time")),1e3*parseFloat(g.getAttribute("dur"))],r.finalTaggedWord=g.id}catch{}let _=null;u.paragraphs.map(m=>m.querySelectorAll("s")).forEach(m=>{m.length&&m.forEach(p=>{if(p.id&&We(p))_=`${p.id}`;else if(/translation/.test(p.className)){const g={};p.hasAttribute("sentence-id")?(g[p.getAttribute("sentence-id")]=p.textContent,r.translations=Object.assign(Object.assign({},r.translations),g)):null!=_&&(g[_]=p.textContent,_=null,r.translations=Object.assign(Object.assign({},r.translations),g))}})})}}if(r.meta["annotations-ids"]){const s=",",u=r.meta["annotations-labels-"+r.language]?r.meta["annotations-labels-"+r.language]:r.meta["annotations-labels"],_=u?u.split(s):[];r.meta["annotations-ids"].split(s).forEach((m,p)=>{var g;r.annotations.push({isVisible:!1,name:null!==(g=_[p].trim())&&void 0!==g?g:m.trim(),id:m.trim()})})}r.assetsStatus.RAS=1}r.hasLoaded+=1})()}componentDidLoad(){const r="https://unpkg.com/@bcgov/bc-sans@1.0.1/css/BCSans.css",n="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined&display=swap";let t=document.querySelector(`link[href="${n}"]`),a=document.querySelector(`link[href="${r}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),document.head.appendChild(t)),a||(a=document.createElement("link"),a.setAttribute("rel","stylesheet"),a.setAttribute("href",r),document.head.appendChild(a)),this.processed_alignment=function qe(r){let n={};for(const t of r)for(const a of t.paragraphs)for(const s of Array.from(a.querySelectorAll("w[time][dur]"))){const u=s.getAttribute("time"),_=s.getAttribute("dur");null!==u&&null!==_&&(n[s.getAttribute("id")]=[Math.round(1e3*parseFloat(u)),Math.round(1e3*parseFloat(_))])}return n}(this.parsed_text),this.alignment_failed=0==Object.keys(this.processed_alignment).length,this.audio_howl=new V.Howl({src:[this.audio],preload:!1}),this.audio_howl.once("load",()=>{this.attachScrollingLogicToAudio()}),this.audio_howl.once("loaderror",()=>{this.hasLoaded+=1,this.assetsStatus.AUDIO=3}),this.audio_howl.load()}attachScrollingLogicToAudio(){this.processed_alignment.all=[0,1e3*this.audio_howl.duration()],this.duration=this.audio_howl.duration(),this.audio_howl_sprites=this.buildSprite(this.audio,this.processed_alignment),this.audio_howl_sprites._reading$.pipe(Me()).subscribe(r=>{if(this.reading$.next(r),""==r)return;this.playing&&this.autoPauseAtEndOfPage&&r in this.endOfPageTags&&this.finalTaggedWord!==r&&(this.autoPauseTimer&&window.clearTimeout(this.autoPauseTimer),this.autoPauseTimer=window.setTimeout(()=>{this.pause()},this.endOfPageTags[r][1]-25));let n=this.tagToQuery(r);if(void 0===n)return;let t=this.el.shadowRoot.querySelector(n);this.el.shadowRoot.querySelectorAll(".reading").forEach(_=>_.classList.remove("reading")),t.classList.add("reading");let a=I._getSentenceContainerOfWord(t).parentElement.id;a!==this.current_page&&(void 0!==this.current_page&&!this.isScrolling&&this.scrollToPage(a),this.current_page=a);const s=Math.ceil(this.el.shadowRoot.querySelector(".pages__container").getBoundingClientRect().left)+1,u=Math.ceil(this.el.shadowRoot.querySelector("#"+this.current_page).getBoundingClientRect().left);(t.getBoundingClientRect().left<0||u!==s)&&(this.isScrolling||this.scrollToPage(a)),this.inPageContentOverflow(t)&&this.autoScroll&&(t.scrollIntoView({block:"start",inline:"nearest"}),this.isScrolling||this.scrollByHeight(t)),this.inParagraphContentOverflow(t)&&this.autoScroll&&(t.scrollIntoView(!1),this.isScrolling||this.scrollByWidth(t))}),this.hasLoaded+=1,this.assetsStatus.AUDIO=1}componentDidRender(){!this.displayTranslation&&this.parsed_text&&this.parsed_text.length>0&&(this.toggleTextTranslation(),this.displayTranslation=!0),this.latestTranslation&&(this.el.shadowRoot.querySelector(this.latestTranslation).focus(),this.latestTranslation="")}isReadyToPlay(){return!(this.hasLoaded<2||void 0===this.audio_howl_sprites||void 0===this.audio_howl_sprites.sound)}getRawI18nString(r){return this.i18nStrings[this.language]&&this.i18nStrings[this.language][r]?this.i18nStrings[this.language][r]:this.i18nStrings.eng[r]?this.i18nStrings.eng[r]:r}getI18nString(r,n={}){let t=this.getRawI18nString(r);for(const[a,s]of Object.entries(n))t=t.replace("<"+a+">",s);return t}addLine(r){this.hasTextTranslations||(this.hasTextTranslations=!0);let n={};n[r.id]="",this.translations=Object.assign(Object.assign({},this.translations),n),this.latestTranslation="#"+r.id+"translation"}removeLine(r){delete this.translations[r.id],this.translations=Object.assign({},this.translations)}updateTranslation(r,n){this.translations[r]=n}handleFiles(r,n){var t=this;return(0,A.Z)(function*(){let a=URL.createObjectURL(r),s={};s[n]=a,t.images=Object.assign(Object.assign({},t.images),s)})()}deleteImage(r){let n={};n[r]=null,this.images=Object.assign(Object.assign({},this.images),n)}render(){return(0,d.h)("div",{key:"757a4fc7fd40bcd41f7685e506bbb4c42da04d1d",id:"read-along-container",class:"read-along-container"},(0,d.h)("div",{key:"6f1180a4e2fe84c16939d5863922f34197ee5243",id:"title__slot__container"},(0,d.h)("h1",{key:"1d931b070e7eb86d580e0d3c054c86abebf117c3",class:"slot__header"},(0,d.h)("slot",{key:"bd826b4e576aa37d375c30c99e7b709235f94199",name:"read-along-header"})),(0,d.h)("h3",{key:"dd7222b9d9086f5fa3c51316ba9559c801e03931",class:"slot__subheader"},(0,d.h)("slot",{key:"55455bbf94fecd94de6e1896d2d358c96a01e7b0",name:"read-along-subheader"}))),Object.entries(this.assetsStatus).map(r=>{let n=r[0],t=r[1];if(2===t){let a=this.getPathFromAssetType(n);return(0,d.h)(this.ErrorMessage,{msg:this.getI18nString("parse-error",{FILETYPE:n,FILENAME:a}),data_cy:n+"-error"})}if(3===t){let a=this.getPathFromAssetType(n);return(0,d.h)(this.ErrorMessage,{msg:this.getI18nString("loading-error",{FILETYPE:n,FILENAME:a}),data_cy:n+"-error"})}}),this.alignment_failed&&1===this.assetsStatus.RAS&&(0,d.h)(this.ErrorMessage,{key:"226d1c10cb9cc671703140d77a94d7a878e5d7a0",msg:this.getI18nString("alignment-error"),data_cy:"alignment-error"}),(0,d.h)("div",{key:"5a19d4b692d9bf911277a0da26f72d0d337911f6",onScroll:()=>{this.handleScrollEvent()},"data-test-id":"text-container",class:"pages__container theme--"+this.theme+" "+this.pageScrolling},this.showGuide?(0,d.h)(this.Guide,null):null,1==this.assetsStatus.RAS&&this.parsed_text.map(r=>(0,d.h)(this.Page,{pageData:r})),this.hasLoaded<2&&(0,d.h)("div",{key:"e8d744128496c0ad5c74a7ee693a993ec1aa99c4",class:"loader"})),this.settingsVisible&&(0,d.h)("div",{key:"2c63799b5372a159df8aeefe5050ca6fa54a4b19",class:"settings-background",onClick:()=>this.settingsVisible=!1}),this.settingsVisible&&(0,d.h)(this.Settings,{key:"833db7a2a93609042056950d7fa6e2eea0531828"}),this.alignment_failed||(0,d.h)("div",{key:"95cf446a50c1eae160e81eb7bc2101086f07d6f6",onClick:r=>this.goToSeekFromProgress(r),id:"all","data-test-id":"progress-bar",class:"overlay__container theme--"+this.theme+" background--"+this.theme},this.svgOverlay?(0,d.h)(this.Overlay,null):null),this.annotationsMenuVisible&&(0,d.h)(this.AnnotationsMenu,{key:"81e596758720825fb829dea9ed0bdf94be85efb8"}),1==this.assetsStatus.AUDIO&&(0,d.h)(this.ControlPanel,{key:"c42772bb33daf39d3c524113cf0a94814514eded"}),this.cssUrl&&null!=this.cssUrl.match(".css")&&(0,d.h)("link",{key:"b42c2cf21142cf90549313fe9c6e24003c81c26e",href:this.cssUrl,rel:"stylesheet"}))}static get assetsDirs(){return["assets"]}get el(){return(0,d.g)(this)}static get watchers(){return{audio_howl_sprites:["wheelHandler"]}}};I.style='.font-weight--100{font-weight:100}.font-weight--200{font-weight:200}.font-weight--300{font-weight:300}.font-weight--400{font-weight:400}.font-weight--500{font-weight:500}.font-weight--600{font-weight:600}.font-weight--700{font-weight:700}.font-weight--800{font-weight:800}.font-weight--900{font-weight:900}.shadowed{text-shadow:0.3px 0.2px black}.theme--light.settings,.theme--light.sentence,.theme--light.page__col__image,.theme--light.page__container,.theme--light.scroll-guide__container{background-color:#fff}.theme--dark.settings,.theme--dark.sentence,.theme--dark.page__col__image,.theme--dark.page__container,.theme--dark.scroll-guide__container{background-color:#3c4369}.sentence__word,.sentence__text,.scroll-guide__text{line-height:1.5;border-radius:0.3125em;position:relative;padding:0.0625em;font-size:1em}.theme--light.ripple,.theme--light.reading,.theme--light.sentence__word,.theme--light.sentence__text,.theme--light.scroll-guide__text{color:#040508}.theme--dark.ripple,.theme--dark.reading,.theme--dark.sentence__word,.theme--dark.sentence__text,.theme--dark.scroll-guide__text{color:#fff}.theme--light.ripple:active,.theme--light.reading:active,.theme--light.sentence__word:hover{color:#fff;background:gray radial-gradient(circle, transparent 1%, gray 1%) center/15000%}.theme--dark.ripple:active,.theme--dark.reading:active,.theme--dark.sentence__word:hover{color:#fff;background:#a6a6a6 radial-gradient(circle, transparent 1%, #a6a6a6 1%) center/15000%}.theme--light.sentence__word.reading{color:#fff;background:#666666 radial-gradient(circle, transparent 1%, #666666 1%) center/15000%}.theme--dark.sentence__word.reading{color:#040508;background:#fff radial-gradient(circle, transparent 1%, #fff 1%) center/15000%}.theme--light.page__col__img-placeholder{border:0.046875em dotted gray}.theme--dark.page__col__img-placeholder{border:0.046875em dotted #a6a6a6}.theme--light.scroll-guide__container,.theme--light.overlay__container{border:0.046875em solid gray}.theme--dark.scroll-guide__container,.theme--dark.overlay__container{border:0.046875em solid #a6a6a6}.theme--light#annotationsMenu,.theme--light.settings,.theme--light.page--multi,.theme--light.pages__container,.theme--light.control-panel{border-left:0.046875em solid gray}.theme--dark#annotationsMenu,.theme--dark.settings,.theme--dark.page--multi,.theme--dark.pages__container,.theme--dark.control-panel{border-left:0.046875em solid #a6a6a6}.theme--light#annotationsMenu,.theme--light.settings,.theme--light.page--multi,.theme--light.pages__container,.theme--light.control-panel{border-right:0.046875em solid gray}.theme--dark#annotationsMenu,.theme--dark.settings,.theme--dark.page--multi,.theme--dark.pages__container,.theme--dark.control-panel{border-right:0.046875em solid #a6a6a6}#annotationsMenu button.theme--light,.theme--light#annotationsMenu,.settings>.theme--light.footer,.theme--light.settings,.theme--light.pages__container{border-top:0.046875em solid gray}#annotationsMenu button.theme--dark,.theme--dark#annotationsMenu,.settings>.theme--dark.footer,.theme--dark.settings,.theme--dark.pages__container{border-top:0.046875em solid #a6a6a6}#annotationsMenu button.theme--light,#annotationsMenu h3.theme--light,.theme--light#annotationsMenu,.theme--light.settings,.theme--light.control-panel{border-bottom:0.046875em solid gray}#annotationsMenu button.theme--dark,#annotationsMenu h3.theme--dark,.theme--dark#annotationsMenu,.theme--dark.settings,.theme--dark.control-panel{border-bottom:0.046875em solid #a6a6a6}.ripple:hover,.reading:hover,.sentence__word:hover{cursor:pointer}@viewport{width:device-width}button{border:0;cursor:pointer}html{background-color:#fff;box-sizing:border-box;height:100%}*:before,*:after{box-sizing:inherit}body{-webkit-font-smoothing:antialiased;color:#040508;font-family:"BCSans", "Noto Sans", Verdana, Arial, sans-serif;min-height:100%;overflow-x:hidden;overflow-y:hidden;text-rendering:optimizeLegibility}a{background:transparent;color:#c69;text-decoration:none;transition:color 0.2s;outline:none}a:active,a:focus{outline:none}img{height:90%;max-width:90%;object-fit:cover}h1,h2,h3,h4,h5,h6{font-family:"BCSans", "Noto Sans", Verdana, Arial, sans-serif;font-weight:normal}p,mat-chip,mat-tab-label,span,button,div,a{font-family:"BCSans", "Noto Sans", Verdana, Arial, sans-serif}.theme--light::-webkit-scrollbar{width:0.5em;height:0.5em}.theme--light::-webkit-scrollbar-track{background:#fff}.theme--light::-webkit-scrollbar-thumb{background:#040508;border-radius:0.3125em;height:0.625em;width:0.625em}.theme--dark::-webkit-scrollbar{width:0.5em;height:0.5em}.theme--dark::-webkit-scrollbar-track{background:#3c4369}.theme--dark::-webkit-scrollbar-thumb{background:#fff;border-radius:0.3125em;height:0.625em;width:0.625em}.bg-img{background-image:url("../assets/img/bg.jpg");height:100vh;overflow:overlay;overflow-x:hidden;background-position:center;background-repeat:no-repeat;background-size:cover;min-height:100%}.shadow-box{box-shadow:0 0.3125rem 1rem 0 rgba(0, 0, 0, 0.24);padding:25px;background:rgba(255, 255, 255, 0.94);border-radius:5px}.font-xs{font-size:0.5em}.font-sm{font-size:0.75em}.font-md{font-size:1em}.font-lg{font-size:1.25em}.font-xl{font-size:1.5em}.font-xxl{font-size:2em}.faded{opacity:0.2;color:black}table{table-layout:fixed}.center{margin-left:auto;margin-right:auto;text-align:center}.container{max-width:80em}.background--light{background:#fff}.stop-color--light{fill:#fff}.color--light{color:#040508}.background--dark{background:#3c4369}.stop-color--dark{fill:#3c4369}.color--dark{color:#fff}.abs{position:absolute}.top-0{top:0}.left-0{left:0}.right-0{right:0}.top-5{top:0.3125em}.left-5{left:0.3125em}.right-5{right:0.3125em}.top-10{top:0.625em}.left-10{left:0.625em}.right-10{right:0.625em}.top-15{top:0.9375em}.left-15{left:0.9375em}.right-15{right:0.9375em}.top-20{top:1.25em}.left-20{left:1.25em}.right-20{right:1.25em}.top-25{top:1.5625em}.left-25{left:1.5625em}.right-25{right:1.5625em}.top-30{top:1.875em}.left-30{left:1.875em}.right-30{right:1.875em}.top-35{top:2.1875em}.left-35{left:2.1875em}.right-35{right:2.1875em}.top-40{top:2.5em}.left-40{left:2.5em}.right-40{right:2.5em}.top-45{top:2.8125em}.left-45{left:2.8125em}.right-45{right:2.8125em}.top-50{top:3.125em}.left-50{left:3.125em}.right-50{right:3.125em}.invisible{visibility:hidden !important}.control-panel{border-radius:0 0 0.3125em 0.3125em;position:relative;min-width:100%;display:inline-flex}.control-panel__buttons--left{width:25%;float:left;margin-top:0.3125em;padding:0.3125em}.control-panel__buttons--center{width:25%;text-align:center;margin:0 auto}.control-panel__buttons--right{width:25%;text-align:right;float:right;margin-top:0.3125em;margin-right:0.3125em}.control-panel__buttons__header{margin:0.3125em}.control-panel__control{border-radius:0.3125em;margin:0.5em auto}.control-panel__control:focus{outline:none}.settings{margin-left:0;margin-right:0;text-align:center}.settings__option__header{margin-bottom:0.5em}#waveform{background-size:contain;background-repeat:no-repeat;background-position:center center;width:100%;height:100%;position:absolute;top:0;left:0}.low{z-index:700}.overlay__container{width:100%;max-width:100%;height:3.125em;position:relative;z-index:800}#overlay__object{z-index:700;max-height:100%;min-width:100%;fill:"transparent"}#overlay__object.theme--light{stroke:gray}#overlay__object.theme--dark{stroke:#a6a6a6}.scroll-guide__container{text-align:center;z-index:700;width:20%;position:fixed;left:50%;transform:translate(-50%, 0)}.scroll-guide__text{font-size:1.25em}.pages__container{overflow:auto;max-height:55vh;height:100%;max-width:100%;width:100%;position:relative;display:-webkit-inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;border-radius:0.3125em 0.3125em 0 0;transition:margin-right 0.5s}.page{overflow-y:hidden;overflow-x:auto;flex-grow:1;min-width:99.6%;width:100%;max-width:55em}.page__container{display:grid;grid-template-columns:[col-start] [col-end];grid-template-rows:[row-start] 5% [row-end] 95%;grid-template-areas:"image page-no" "image text";justify-items:stretch}.page__counter{grid-area:page-no;margin:0.625em 0 0 0.9375em;text-align:right;padding-right:0.9375em;max-height:5rem}.page__col__image{grid-area:image;max-height:100%;text-align:center;margin:5%;padding:0;border-radius:0 0 0 0;position:relative}.page__col__image img{max-height:55vh;max-width:95%;object-fit:contain}.page__col__img-placeholder{cursor:pointer}.page__col__text{grid-area:text}.page.two-column-layout-page{grid-template-columns:40% auto}.page.one-column-layout-page{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;overflow-y:auto}.page.one-column-layout-page .page__col__image img{max-height:33vh !important}.page.one-column-layout-page .page__counter{width:100%;display:block;text-align:center}.hide-page-counter .page__counter{display:none}.pages__container.vertical{flex-direction:column !important}.pages__container.vertical>.page{min-height:100%}.paragraph__container{overflow-y:auto;min-width:40%;padding-bottom:0.75em}.sentence{margin:0 1.5em;text-align:left;max-width:90%}.sentence__container{margin:3.75em 0.625em 3.75em 0.625em;scroll-behavior:smooth;max-width:100%;position:relative;overflow-y:auto;overflow-x:hidden}.sentence__container__buttons{position:absolute;top:0;right:0}.sentence__text{font-size:1.5em;padding:0}.sentence__word{font-size:1.5em}.sentence__translation .sentence__text,.sentence[annotation-id] .sentence__text,.sentence__translation .sentence__word{color:#777;font-style:italic;font-size:95%}.sentence__translation__button{margin-left:10px}.sentence__translation__button i{font-size:medium}.paragraph.visually_aligned .sentence .sentence__text,.paragraph.visually_aligned .sentence .sentence__word{display:table-cell}.paragraph.visually_aligned .sentence .sentence__text:empty{display:none}.paragraph.visually_aligned{display:table}.paragraph.visually_aligned .sentence{display:table-row}.read-along-container{max-width:75em;margin:0 auto;overflow-y:hidden;overflow-x:hidden;padding:0.3125em;position:relative}.read-along-container--fullscreen{max-width:80%;min-width:80%}.slot__header{margin-bottom:0.3125em}.slot__subheader{margin-top:0;margin-left:1em}.settings-background{position:fixed;top:0;left:0;height:100vh;width:100vw;background-color:rgba(0, 0, 0, 0.075);z-index:900;-webkit-backdrop-filter:blur(5px) !important;backdrop-filter:blur(5px) !important}.settings{height:55vh;max-height:55vh;width:375px;max-width:375px;position:fixed;z-index:1000;top:15vh;left:calc((100% - 375px) / 2);overflow-x:hidden;transition:0.5s}.settings h3{border-bottom:1px solid #ccc;padding:10px;margin:0}.settings h3 button{float:inline-start;margin-top:0;margin-bottom:0}.settings>.close{position:relative;float:inline-end;background-color:inherit;color:inherit;font-size:18px;display:inline-block;padding:0.275rem 0.75rem;font-weight:400;line-height:1.5;text-align:center;text-decoration:none;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;border:0;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.settings>.close:hover{color:#fff;background-color:#bb2d3b;border-color:#bb2d3b;box-shadow:inset 0 1px 0 rgba(255, 255, 255, 0.15), 0 1px 1px rgba(0, 0, 0, 0.075)}.settings p{cursor:pointer;text-align:left;color:inherit;margin:0.5em 1em}.settings p select,.settings p button{margin-right:1em;width:80px;text-align:justify}.settings p button{margin:0 1em 0 0;padding:0 0.0625em}.settings>.footer{position:absolute;bottom:0;right:0;left:0;padding:0.01em 1em;height:3em;display:flex;flex-grow:0;flex-shrink:0;flex-direction:row;align-content:space-between;justify-content:space-between}.settings>.footer>div{flex-grow:8}.settings>.footer>button{border:1px solid #ccc;padding:0.25em 0.5em !important}.settings>.footer>button:hover{background-color:rgba(0, 0, 0, 0.15);box-shadow:1px 1px 1px rgba(0, 0, 0, 0.15)}.settings button:disabled{background-color:rgba(200, 200, 200, 0.15);color:#ccc}.settings p.version{padding:1em;font-size:0.7em;font-weight:100;color:#ccc}.settings.theme--dark{color:#fff}@media screen and (max-width: 385px){.settings{width:95vw;max-width:95vw;left:2.5vw;overflow:auto}.settings p{margin-bottom:1em;border-bottom:1px solid #ccc}.settings p select,.settings p button{display:block;width:80%}}button:focus,input:focus{box-shadow:0 1px 1px rgba(0, 0, 0, 0.15)}#annotationsMenu{position:absolute;bottom:4em;right:0.3125em;z-index:1000;width:fit-content;width:-moz-fit-content;display:flex;flex-direction:column;border-radius:0.3125em}#annotationsMenu h3{margin:0.3125em 0;padding:0.3125em 0.5em}#annotationsMenu button{display:flex;justify-content:flex-start;align-content:baseline;font-size:medium;padding:0.5em}#annotationsMenu button .material-icons-outlined{font-size:inherit;border-radius:0;margin-right:0.3125em}.sentence.invisible[annotation-id]{display:none}.loader{border:16px solid #eee;border-radius:50%;border-right-color:#aa0;border-bottom-color:#a33;border-left-color:#111;width:10rem;height:10rem;-webkit-animation:spin 3s linear infinite;animation:spin 3s linear infinite;position:fixed;top:calc(50vh - 10rem);left:calc(50vw - 10rem);z-index:1000;box-shadow:0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.alert{position:relative;padding:1rem 1rem;margin-bottom:1rem;border:1px solid transparent;border-radius:0.25rem;transition-delay:2s;transition:visibility 5s height 5s}.alert.status-success{color:#0f5132;background-color:#d1e7dd;border-color:#badbcc}.alert.status-error{color:#842029;background-color:#f8d7da;border-color:#f5c2c7}.alert.fade{visibility:collapse;height:0 !important;overflow:hidden !important;line-height:0 !important;padding:0 !important;margin:0 !important;border:0 !important}.animate-transition,.ripple,.reading{transition:background 0.4s}.animate-transition:active,.ripple:active,.reading:active{transition:background 0s}.ripple,.reading{background-position:center;padding:0.0625em}.ripple:active,.reading:active{background-size:100%}.progress{position:absolute;top:0;left:0;height:100%;width:0}.progress.theme--light{background-color:rgba(128, 128, 128, 0.2)}.progress.theme--dark{background-color:rgba(166, 166, 166, 0.2)}.material-icons{font-family:"Material Icons";font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:"liga";-webkit-font-smoothing:antialiased}.material-icons-outlined{font-family:"Material Icons Outlined";font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:"liga";-webkit-font-smoothing:antialiased}[contenteditable][data-placeholder]:empty:before{content:attr(data-placeholder);position:absolute;color:gray;cursor:text;background-color:transparent}.drop-area{border:2px dashed #ccc;border-radius:20px;width:50%;font-family:sans-serif;margin:50px auto;padding:20px}.drop-area.highlight{border-color:purple}p{margin-top:0}.my-form{margin-bottom:10px}#gallery{margin-top:10px}#gallery img{width:150px;margin-bottom:10px;margin-right:10px;vertical-align:middle}.button{display:inline-block;padding:10px;background:#ccc;cursor:pointer;border-radius:5px;border:1px solid #ccc}.button:hover{background:#ddd}.fileElem{display:none}#img-remover{margin:60px;position:absolute;z-index:700;border-radius:50px;color:red}#image-container{display:contents}'}}]);